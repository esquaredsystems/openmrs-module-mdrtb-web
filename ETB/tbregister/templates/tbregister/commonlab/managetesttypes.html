{% extends 'tbregister/base_without_dd.html' %}

{% block content %}
<div id="modal-parent" class="relative ">
  
  <section id="modal" class="flex flex-col justify-center transition-opacity ease-in-out duration-500 opacity-0 backdrop-blur-3xl inset-0 z-50 shadow-2xl  m-10  bg-white w-3/5 mx-auto p-8 absolute top-0 left-0 right-0 bottom-0 h-min my-auto ">
    <div class="flex items-center justify-between ">
      <h3 id="modal-testType" class="text-3xl">Sort Weight Order</h3>
      <svg id="close-modal" onclick="closeModal()" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-white bg-red-700 cursor-pointer">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg>
      
      
    </div>
    <div class="m-4">
      <div class="accordion" id="attrAccordion">
    
      </div>
  </section>
    <section>
        <div class="container mx-auto px-4 sm:px-8">
            <div class="py-8">
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                  <h2 class="text-4xl font-bold leading-tight text-[#2d9cdb]">Test Types</h2>
                  <a href="{% url 'addtesttypes' %}" class="text-[#044062] font-bold underline">Add new</a>
                  
                </div>
                <div class="flex items-center rounded-md cursor-pointer shadow-sm bg-gray-200 justify-between px-2">
                  <input
          class="border-none focus:ring-0 bg-transparent"
          type="text"
          placeholder="Search for Test Types"
        />
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="w-6 h-6"
                  >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"
          />
        </svg>
                </div>
              </div>
              <div class="-mx-4 sm:-mx-8 px-4 sm:px-8 py-4 overflow-x-auto">
                <div
                  class="inline-block min-w-full shadow-md rounded-lg overflow-hidden"
                >
                  <table class="min-w-full leading-normal">
                    <thead>
                      <tr>
                        <th
                          class="px-5 py-3 border-b-2 border-gray-800 bg-[#9DC6DE] text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"
                        >
                          Name
                        </th>
                        <th
                          class="px-5 py-3 border-b-2 border-gray-800 bg-[#9DC6DE] text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"
                        >
                          Short Name
                        </th>
                        <th
                          class="px-5 py-3 border-b-2 border-gray-800 bg-[#9DC6DE] text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"
                        >
                          Description
                        </th>
                        
                        <th
                          class="px-5 py-3 border-b-2 border-gray-800 bg-[#9DC6DE] text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"
                        >
                        Actions
                      </th>
                      </tr>
                    </thead>
                    <tbody>
                      {% if response %}
                      {% for item in response %}
                      <tr>
                        <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                          <div class="flex">
                            <div class="ml-3">
                              <p class="text-gray-900 whitespace-no-wrap">
                                {{item.name}}
                              </p>
                            </div>
                          </div>
                        </td>
                        <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                          <p class="text-gray-900 whitespace-no-wrap">{{item.shortName}}</p>
                        </td>
                        <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                          <p class="text-gray-900 whitespace-no-wrap">{{item.description}}</p>
                        </td>
                        
                        <td
                          class="px-5 py-5 border-b border-gray-200 bg-white text-sm text-right"
                        >
                          <div class="flex items-center space-x-4 justify-end cursor-pointer">
                            <svg onclick="showModal('{{item.uuid}}')" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 cursor-pointer">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            <a href="{% url 'addtesttypes'  %}/{{item.uuid}}?state=edit">
                              <svg  xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 cursor-pointer text-black">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" />
                              </svg>
                            </a>
                            
                          </div>
                        </td>
                      </tr>
                      {% endfor %}
                      {% endif %}
                      
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
    </section>
  </div>
  <script>
    function showModal(uuid){
      console.log(uuid)
      let output = ''
      $('#modal').removeClass('opacity-0')
        $.ajax(
          {
            url : "{% url 'testattr' %}?uuid=" + `${uuid}`,
            method: 'GET',
            success : function(data){
             
              for(i=0;i<data.attributes.length;i++){
                
                output += `<div class='accordion-item bg-white border border-gray-200'>
                  
                  <h2 class="accordion-header mb-0" id="heading${i}">
            <button class="accordion-button py-4 px-5 bg-white text-black" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${i}" aria-expanded="false"
              aria-controls="collapse${i}">
             ${data.attributes[i].attrName}
            </button>
          </h2>
          <div id="collapse${i}" class="accordion-collapse collapse show" aria-labelledby="heading${i}"
            data-bs-parent="#accordionExample">
            <div class="accordion-body py-4 px-5">
             <div>
               <span>
                <strong>Test Type:</strong>
               </span>
               <span>
                ${i+1}
               </span>
             </div>
             <div>
               <span>
                <strong>Sort Weight:</strong> 
               </span>
               <span>${data.attributes[i].sortWeight}</span>
             </div>
             <div>
               <span>
                <strong>Multiset Name:</strong> 
               </span>
               <span>
                ${data.attributes[i].multisetName}
               </span>
             </div>
             <div>
               <span>
                <strong>Group Name:</strong>
               </span>
               <span>
                ${data.attributes[i].groupName}
               </span>
             </div>
            </div>
          </div>
                  
                  </div>`
                $('#attrAccordion').html(
                  output
                )
              }
            }
          }
        )
    }

    function closeModal(){
      $('#modal').addClass('opacity-0')
      let output = ""
      
      $('#attrAccordion').html(output)
    }
</script>
{% endblock %}

