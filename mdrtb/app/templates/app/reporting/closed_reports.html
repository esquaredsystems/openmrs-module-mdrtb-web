{% extends 'app/base/base.html' %}


{% block title %}
{{title}}
{% endblock %}


{%block content%}
{% if report_data %}
<style>
    .btn-primary {
        background: #2D9CDB !important;
    }
</style>

<div class="m-12 rounded">
    <table class="table table-bordered">
        <thead class=" table-dark">
            <th>Report Name</tH>
            <th>Report Date</th>
            <th>Region</th>
            <th>District</th>
            <th>Facility</th>
            <th>Year</th>
            <th>Month</th>
            <th>Quarter</th>
            <th>Status</th>
            <th colspan="2">Actions</th>
        </thead>
        <tbody>
            {% for report in report_data %}

            <tr>
                <td>{{report.reportName}}</td>
                <td>02/03/2023</td>
                <!-- If the selected location is region -->
                {% if report.location.parent is None and report.location.grandparent is None %}
                <td>{{report.location.location}}</td>
                <td>-</td>
                <td>-</td>
                {% endif %}
                <!-- If the selected location is district -->
                {% if report.location.parent and report.location.grandparent is None %}
                <td>{{report.location.parent}}</td>
                <td>{{report.location.location}}</td>
                <td>-</td>
                {% endif %}
                <!-- If the selected location is facility -->
                {% if report.location.parent and report.location.grandparent %}
                <td>{{report.location.grandparent}}</td>
                <td>{{report.location.parent}}</td>
                <td>{{report.location.location}}</td>
                {% endif %}
                <td>{{report.year}}</td>
                {% if report.month is None %}
                <td>-</td>
                {% else %}
                <td>{{report.month}}</td>
                {% endif %}
                {% if report.quarter is None %}
                <td>-</td>
                {% else %}
                <td>{{report.quarter}}</td>
                {% endif %}
                <td><strong>{{report.reportStatus}}</strong></td>
                <td colspan="2" class="flex items-center space-x-4">
                    <a class="no-underline outline-none" target="_blank"
                        href="{% url 'viewclosedreport' uuid=report.uuid %}">
                        <button class="btn btn-primary d-flex align-items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="w-5 h-5 cursor-pointer">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            <span class="ml-2">View</span>
                        </button>
                    </a>
                    {% if report.reportStatus != "LOCKED" %}
                    <a href="#">
                        <button class="btn btn-secondary d-flex align-items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="w-4 h-4">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" />
                            </svg>
                            <span class="ml-2">Lock</span>
                        </button>
                    </a>
                    {% else %}
                    {% if unlock_privilege %}
                    <a class="no-underline outline-none" href="#">
                        <button class="btn btn-secondary d-flex align-items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="w-4 h-4">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M13.5 10.5V6.75a4.5 4.5 0 119 0v3.75M3.75 21.75h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H3.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" />
                            </svg>

                            <span class="ml-2">Unlock</span>
                        </button>
                    </a>
                    {% endif %}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>

    </table>

    <button class="button-primary w-1/6"><a href="javascript:history.go(-1)"
            class="no-underline text-white">Back</a></button>


</div>
<script>
    console.log(JSON.parse("{{jsondata|escapejs}}"))
</script>
{% else %}
<div class="mx-auto w-2/4">
    <form onsubmit="disableSubmit()" action="{% url 'closedreports' %}" method="post" class="flex flex-col space-y-6">
        {% csrf_token %}
        <h2 class="page-title">{{"mdrtb.viewClosedReports"|get_message:request.session.locale}}</h2>
        <div>
            {% include 'app/components/locations.html' %}
        </div>
        <div class="input-container">
            <label class="input-label w-1/6"
                for="report">{{"mdrtb.viewClosedReports.reportName"|get_message:request.session.locale}}</label>
            <select name="report" id="report" class="input form-control">
                <option value="">Select</option>
                {% for report in reports %}
                <option value="{{report.value}}">{{report.report_name}}</option>
                {% endfor %}
            </select>
        </div>

        <div class="input-container">
            <label class="input-label w-1/6" for="year">{{"mdrtb.year"|get_message:request.session.locale}}</label>
            <input required type="text" class="input form-control" name="year" size="4" id="year">
        </div>
        <div class="input-container">
            <label class="input-label w-1/6" for="month">{{"mdrtb.month"|get_message:request.session.locale}}</label>
            <select required name="month" id="month" class="input form-control">
                <option value="">Select</option>
                {% for month in months %}
                <option value="{{month.value}}">{{month.name}}</option>
                {% endfor %}
            </select>
        </div>
        <div class="input-container">
            <label class="input-label w-1/6"
                for="quarter">{{"mdrtb.quarter"|get_message:request.session.locale}}</label>

            <div class="flex items-center w-full space-x-4">
                <div class="space-x-2 flex items-center">
                    <label for="">Select</label>
                    <input checked type="radio" name="quarter" id="quarter" class="radio-input" value="">
                </div>
                {% for quarter in quarters %}
                <div class="space-x-2 flex items-center">
                    <label for="quarter">{{quarter}}</label>
                    <input type="radio" name="quarter" id="quarter" class="radio-input" value="{{quarter}}">
                </div>
                {% endfor %}

            </div>
        </div>
        <div class="flex-center space-x-4 mt-4">
            <button type="submit" id="submitBtn"
                class="button-primary w-1/5">{{'general.submit'|get_message_openMRS:request.session.locale}}</button>

            <a href="javascript:history.go(-1)" class="cancel-button">
                {{'general.cancel'|get_message_openMRS:request.session.locale}}
            </a>
        </div>

    </form>
</div>
<script type="text/javascript">
    $('#region-select').prop('required', true)
    $('#month').change((e) => {
        if (e.target.value != '') {
            $('#quarter').prop('disabled', true)
            $('#quarter').prop('title', 'Quarter cannot be selected with month')
            $('#quarter').prop('required', false)
        } else {
            $('#quarter').prop('disabled', false)
            $('#quarter').prop('title', '')
            $('#quarter').prop('required', true)
        }
    })
    $("input[name='quarter']").change((e) => {


        if (e.target.value != '') {
            $('#month').prop('disabled', true)
            $('#month').prop('title', 'Month cannot be selected with quarter')
        } else {
            $('#month').prop('disabled', false)
            $('#month').prop('title', '')
        }
    })
    const disableSubmit = () => {
        $('#submitBtn').prop('disabled', true)
        $('#submitBtn').removeClass('button-primary')
        $('#submitBtn').html(`
        <lord-icon src="https://cdn.lordicon.com/dpinvufc.json" trigger="loop"
                colors="primary:#000,secondary:#08a88a" style="width:50px;height:50px">
            </lord-icon>

        
        `)
    }


</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</script>
{% endif %}

{% endblock %}