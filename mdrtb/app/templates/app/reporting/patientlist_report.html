{% extends 'app/reporting/report_base.html' %}

{% block content %}


<div>
    <div style="font-size: 0.75rem;">

        <p class="text-xl"><b>Year:</b> {{year}}</p>
        <p class="text-xl"><b>Location:</b> {{location}}</p>
        {% if month %}
        <p><b>Month:</b> {{month}}</p>
        {% elif quarter %}
        <p><b>Quarter:</b> {{quarter}}</p>
        {% endif %}
        <p><b>List:</b> {{listname}}</p>
    </div>
    <div>{{ string_data|safe }}</div>
    <a class="no-underline" href="{% url 'patientlist' %}"><button>
            Back
        </button></a>
    <button onclick="print()">{{'mdrtb.print'|get_message:request.session.locale}}</button>
    <button onclick="saveHtml()">{{'mdrtb.save'|get_message:request.session.locale}}</button>
</div>
<script>
    function saveHtml() {
        let htmlContent = document.getElementById("tb03").outerHTML;
        htmlContent = htmlContent.replace(/\s{2,}/g, ' ');
        let year = "{{request.GET.year}}"
        let location = "{{request.GET.location}}"
        let quarter = "{{request.GET.quarter}}" ? "{{request.GET.quarter}}" : null;
        let month = "{{request.GET.month}}" ? "{{request.GET.month}}" : null;

        data = {
            csrfmiddlewaretoken: "{{csrf_token}}",
            reportName: "TB-03",
            year,
            location,
            reportType: "DOTSTB",
            tableData: htmlContent
        }

        if (month != null) data.month = month
        if (quarter != null) data.quarter = quarter


        $.ajax({
            method: "POST",
            url: "/saveclosedreport",
            data: data,
            success: (data) => {
                console.log(data)
            }
        })


    }
</script>

{% endblock %}