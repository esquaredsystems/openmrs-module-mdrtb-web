{% extends 'app/base/report_base.html' %}

{% block content %}

<div>
    <style>
        td {
            width: fit-content;
        }
        th {
            width: fit-content;
        }
        table {
            width: fit-content;
        }
    </style>
    <div>
        <div id="tb03">
            <table id="resultsTable" class="resultsTable" border="1" cellspacing="0">
                <tr>
                    <th class="rotate" rowspan="4">
                        <div>
                            {{'mdrtb.tb03.registrationNumber'|get_message:request.session.locale}}
                        </div>
                    </th>
                    <th class="rotate" rowspan="4">
                        <div><span>{{'mdrtb.tb03.dateOfRegistration'|get_message:request.session.locale}}</span>
                        </div>
                    </th>
                    <th rowspan="4">{{'mdrtb.tb03.fullName'|get_message:request.session.locale}}</th>
                    <th class="rotate" rowspan="4">
                        <div><span>{{'mdrtb.tb03.gender'|get_message:request.session.locale}}</span></div>
                    </th>
                    <th class="normal" rowspan="2">{{'mdrtb.tb03.age'|get_message:request.session.locale}}</th>
                    <th rowspan="4">{{'mdrtb.tb03.address'|get_message:request.session.locale}}</th>
                    <th class="normal" rowspan="2">
                        <div>{{'mdrtb.tb03.mfForIP'|get_message:request.session.locale}}</div>
                    </th>
                    <th class="normal" rowspan="2">
                        {{'mdrtb.tb03.treatmentRegimen'|get_message:request.session.locale}}
                    </th>
                    <th class="rotate" rowspan="4">
                        <div><span>{{'mdrtb.tb03.tbLocalization'|get_message:request.session.locale}}</span></div>
                    </th>
                    <th class="reggroup" colspan="8">
                        {{'mdrtb.tb03.registrationGroup'|get_message:request.session.locale}}
                    </th>
                    <th class="rotate" rowspan="4">
                        <div><span>{{'mdrtb.tb03.transferFrom'|get_message:request.session.locale}}</span></div>
                    </th>
                    <th class="reggroup" colspan="3">
                        {{'mdrtb.tb03.tbHivActivities'|get_message:request.session.locale}}
                    </th>
                    <th class="reggroup" colspan="17">
                        {{'mdrtb.tb03.diagnosticMethod'|get_message:request.session.locale}}
                    </th>
                    <th class="normal" rowspan="2" rowspan="2">
                        {{'mdrtb.tb03.dstSampleCollectionDate'|get_message:request.session.locale}}
                    </th>
                    <th class="reggroup" colspan="17" rowspan="1">
                        {{'mdrtb.tb03.dst'|get_message:request.session.locale}}
                    </th>

                    <th class="rotate" rowspan="4">
                        <div><span>{{'mdrtb.tb03.drugResistance'|get_message:request.session.locale}}</span>
                        </div>
                    </th>
                    <th class="reggroup" colspan="9">
                        {{'mdrtb.tb03.smearMonitoring'|get_message:request.session.locale}}
                    </th>
                    <th class="reggroup" colspan="6">
                        {{'mdrtb.tb03.treatmentOutcome'|get_message:request.session.locale}}
                    </th>
                    <th class="rotate" rowspan="4">
                        <div><span>{{'mdrtb.tb03.canceled'|get_message:request.session.locale}}</span></div>
                    </th>
                    <th class="rotate" rowspan="4">
                        <div><span>{{'mdrtb.tb03.startedRegimen2'|get_message:request.session.locale}}</span></div>
                    </th>
                    <th class="rotate" rowspan="4">
                        <div><span>{{'mdrtb.tb03.transferOut'|get_message:request.session.locale}}</span></div>
                    </th>
                    <th class="normal" rowspan="4">
                        <div><span>{{'mdrtb.tb03.notes'|get_message:request.session.locale}}</span></div>
                    </th>
                </tr>
                <tr>

                    <th class="rotate" rowspan="3">
                        <div>
                            <span>{{'mdrtb.tb03.new'|get_message:request.session.locale}}</span>
                        </div>
                    </th>
                    <th class="rotate" rowspan="2">
                        <div>
                            <span>{{'mdrtb.tb03.relapseAfter'|get_message:request.session.locale}}</span>
                        </div>
                    </th>
                    <th class="rotate" rowspan="2">
                        <div><span>{{'mdrtb.tb03.relapseAfter'|get_message:request.session.locale}}</span></div>
                    </th>

                    <th class="rotate" rowspan="2">
                        <div><span>{{'mdrtb.tb03.defaultAfter'|get_message:request.session.locale}}</span></div>
                    </th>
                    <th class="rotate" rowspan="2">
                        <div><span>{{'mdrtb.tb03.defaultAfter'|get_message:request.session.locale}} </span></div>
                    </th>
                    <th class="rotate" rowspan="2">
                        <div><span>{{'mdrtb.tb03.failureAfter'|get_message:request.session.locale}}</span></div>
                    </th>
                    <th class="rotate" rowspan="2">
                        <div><span>{{'mdrtb.tb03.failureAfter'|get_message:request.session.locale}}</span></div>
                    </th>
                    <th class="rotate" rowspan="3">
                        <div><span>{{'mdrtb.tb03.other'|get_message:request.session.locale}}</span></div>
                    </th>
                    <th class="rotate" rowspan="2">
                        <div><span>{{'mdrtb.tb03.hivTest'|get_message:request.session.locale}}</span></div>
                    </th>
                    <th class="rotate" rowspan="2">
                        <div><span>{{'mdrtb.tb03.artTest'|get_message:request.session.locale}}</span></div>
                    </th>
                    <th class="rotate" rowspan="2">
                        <div><span>{{'mdrtb.tb03.cpTest'|get_message:request.session.locale}}</span></div>
                    </th>
                    <th class="normal" colspan="3">{{'mdrtb.tb03.microscopy'|get_message:request.session.locale}}
                    </th>
                    <th class="normal" colspan="3">{{'mdrtb.tb03.genexpert'|get_message:request.session.locale}}
                    </th>
                    <th class="normal" colspan="4">{{'mdrtb.tb03.hain'|get_message:request.session.locale}}</th>
                    <th class="normal" colspan="4">{{'mdrtb.tb03.hain2'|get_message:request.session.locale}}</th>
                    <th class="normal" colspan="3">{{'mdrtb.culture'|get_message:request.session.locale}}</th>
                    <th class="dst" rowspan="3">
                        <div>R</div>
                    </th>
                    <th class="dst" rowspan="3">
                        <div>H</div>
                    </th>
                    <th class="dst" rowspan="3">
                        <div>E</div>
                    </th>
                    <th class="dst" rowspan="3">
                        <div>S</div>
                    </th>
                    <th class="dst" rowspan="3">
                        <div>Z</div>
                    </th>
                    <th class="dst" rowspan="3">
                        <div>Km</div>
                    </th>
                    <th class="dst" rowspan="3">
                        <div>Am</div>
                    </th>
                    <th class="dst" rowspan="3">
                        <div>Cm</div>
                    </th>
                    <th class="widedst" rowspan="3">
                        <div>Ofx/Lfx</div>
                    </th>
                    <th class="dst" rowspan="3">
                        <div>Mfx</div>
                    </th>
                    <th class="dst" rowspan="3">
                        <div>Pto</div>
                    </th>
                    <th class="dst" rowspan="3">
                        <div>Cs</div>
                    </th>
                    <th class="dst" rowspan="3">
                        <div>PAS</div>
                    </th>
                    <th class="dst" rowspan="3">
                        <div>Lzd</div>
                    </th>
                    <th class="dst" rowspan="3">
                        <div>Cfz</div>
                    </th>
                    <th class="dst" rowspan="3">
                        <div>Bdq</div>
                    </th>
                    <th class="dst" rowspan="3">
                        <div>Dlm</div>
                    </th>
                    <th class="normal" colspan="3">
                        {{'mdrtb.tb03.m234'|get_message:request.session.locale}}<br/>{{'mdrtb.tb03.month'|get_message:request.session.locale}}
                    </th>
                    <th class="normal" colspan="3">{{'mdrtb.tb03.five'|get_message:request.session.locale}}
                        {{'mdrtb.tb03.month'|get_message:request.session.locale}}
                    </th>
                    <th class="normal" colspan="3">{{'mdrtb.tb03.m68'|get_message:request.session.locale}}
                        {{'mdrtb.tb03.month'|get_message:request.session.locale}}
                    </th>
                    <th class="rotate" rowspan="3">
                        <div><span>{{'mdrtb.tb03.cured'|get_message:request.session.locale}}</span></div>
                    </th>
                    <th class="rotate" rowspan="3">
                        <div><span>{{'mdrtb.tb03.txCompleted'|get_message:request.session.locale}}</span></div>
                    </th>
                    <th class="rotate" rowspan="3">
                        <div><span>{{'mdrtb.tb03.failure'|get_message:request.session.locale}}</span></div>
                    </th>
                    <th class="normal" colspan="2">{{'mdrtb.tb03.died'|get_message:request.session.locale}}</th>
                    <th class="rotate" rowspan="3">
                        <div><span>{{'mdrtb.tb03.ltfu'|get_message:request.session.locale}}</span></div>
                    </th>

                </tr>
                <tr>
                    <th class="normal" rowspan="2">{{'mdrtb.tb03.dateOfBirth'|get_message:request.session.locale}}
                    </th>
                    <th class="normal" rowspan="2">
                        <div>{{'mdrtb.tb03.mfForFP'|get_message:request.session.locale}}</div>
                    </th>
                    <th class="normal" rowspan="2">
                        {{'mdrtb.tb03.treatmentStartDate'|get_message:request.session.locale}}
                    </th>

                    <th class="normal" colspan="3">
                        {{'mdrtb.tb03.microscopyResult'|get_message:request.session.locale}}
                    </th>
                    <th class="normal" colspan="3">{{'mdrtb.tb03.xpertResult'|get_message:request.session.locale}}
                    </th>
                    <th class="normal">{{'mdrtb.date'|get_message:request.session.locale}}</th>
                    <th class="normal" colspan="3">
                        {{'mdrtb.tb03.hainCultureResult'|get_message:request.session.locale}}
                    </th>
                    <th class="normal">{{'mdrtb.date'|get_message:request.session.locale}}</th>
                    <th class="normal" colspan="3">
                        {{'mdrtb.tb03.hainCultureResult'|get_message:request.session.locale}}
                    </th>
                    <th class="normal" colspan="3">
                        {{'mdrtb.tb03.hainCultureResult'|get_message:request.session.locale}}
                    </th>
                    <th class="normal" rowspan="2">{{'mdrtb.tb03.dstResultDate'|get_message:request.session.locale}}
                    </th>

                    <th class="normal" colspan="3">{{'mdrtb.tb03.result'|get_message:request.session.locale}}</th>
                    <th class="normal" colspan="3">{{'mdrtb.tb03.result'|get_message:request.session.locale}}</th>
                    <th class="normal" colspan="3">{{'mdrtb.tb03.result'|get_message:request.session.locale}}</th>

                    <th class="rotate" rowspan="2">
                        <div><span>{{'mdrtb.tb03.ofTb'|get_message:request.session.locale}}</span></div>
                    </th>
                    <th class="rotate" rowspan="2">
                        <div><span>{{'mdrtb.tb03.ofOther'|get_message:request.session.locale}}</span></div>
                    </th>

                </tr>
                <tr>
                    <th class="normal" rowspan="1">I</th>
                    <th class="normal" rowspan="1">II</th>
                    <th class="normal" rowspan="1">I</th>
                    <th class="normal" rowspan="1">II</th>
                    <th class="normal" rowspan="1">I</th>
                    <th class="normal" rowspan="1">II</th>
                    <th class="normal">{{'mdrtb.date'|get_message:request.session.locale}}</th>
                    <th class="normal">{{'mdrtb.tb03.startDate'|get_message:request.session.locale}}</th>
                    <th class="normal">{{'mdrtb.tb03.startDate'|get_message:request.session.locale}}</th>

                    <th>{{'mdrtb.date'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.tb03.testNumber'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.lab'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.date'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.tb03.testNumber'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.lab'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.tb03.testNumber'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.tb03.hResult'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.tb03.rResult'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.lab'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.tb03.testNumber'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.tb03.iResult'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.tb03.fResult'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.lab'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.date'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.tb03.testNumber'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.lab'|get_message:request.session.locale}}</th>

                    <th>{{'mdrtb.date'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.tb03.testNumber'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.lab'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.date'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.tb03.testNumber'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.lab'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.date'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.tb03.testNumber'|get_message:request.session.locale}}</th>
                    <th>{{'mdrtb.lab'|get_message:request.session.locale}}</th>
                </tr>
                {% for row in patientSet %}
                <tr {% if forloop.counter|divisibleby:2 %} bgcolor="#D3D3D3" {% endif %}>
                    <td rowspan="2">
                        <div><span>{{ row.identifier }}</span></div>
                    </td>
                    <td rowspan="2">{{ row.tb03RegistrationDate }}</td>
                    <td rowspan="2">{{ row.personName.familyName }}, {{ row.personName.givenName }}</td>
                    <td rowspan="2" align="center">{{ row.gender }}</td>
                    <td align="center">{{row.ageAtTB03Registration }}</td>
                    <td rowspan="2">{{ row.personAddress.address1 }}, {{ row.personAddress.region }},
                        <br>{{ row.personAddress.stateProvince }}
                    </td>
                    <td>{{row.intensivePhaseFacility }}</td>
                    <td align="center">{{row.treatmentRegimen }}</td>

                    <td align="center" rowspan="2">{{ row.siteOfDisease }}</td>
                    {% for loop in '9'|get_range %}
                    <td align="center" rowspan="2">
                        {% if row.regGroup == loop %}&#10004;{% endif %}
                    </td>
                    {% endfor %}

                    <td>{{row.hivTestResult }}</td>
                    <td rowspan="2">{{row.artStartDate }}</td>
                    <td rowspan="2">{{row.cpStartDate }}</td>

                    <td colspan="3" align="center">{{row.diagnosticSmearResult }}</td>
                    <td colspan="3" align="center">{{row.xpertMTBResult }} {{row.xpertRIFResult }}</td>
                    <td align="center">{{row.hainTestDate }}</td>
                    <td colspan="3" align="center">{{row.hainMTBResult }}</td>
                    <td align="center">{{row.hain2TestDate }}</td>
                    <td colspan="3" align="center">{{row.hain2MTBResult }}</td>
                    <td colspan="3" align="center">{{row.cultureResult }}</td>
                    <td>{{ row.dstCollectionDate}}</td>
                    <td rowspan="2" align="center">{{ 'R RESISTANCE' |get_dict_item_by_key:row.dstResults }}</td>
                    <td rowspan="2" align="center">{{ 'H RESISTANCE' |get_dict_item_by_key:row.dstResults }}</td>
                    <td rowspan="2" align="center">{{ 'E RESISTANCE' |get_dict_item_by_key:row.dstResults }}</td>
                    <td rowspan="2" align="center">{{ 'S RESISTANCE' |get_dict_item_by_key:row.dstResults }}</td>
                    <td rowspan="2" align="center">{{ 'Z RESISTANCE' |get_dict_item_by_key:row.dstResults }}</td>
                    <td rowspan="2" align="center">{{ 'KM RESISTANCE' |get_dict_item_by_key:row.dstResults }}</td>
                    <td rowspan="2" align="center">{{ 'AM RESISTANCE' |get_dict_item_by_key:row.dstResults }}</td>
                    <td rowspan="2" align="center">{{ 'CM RESISTANCE' |get_dict_item_by_key:row.dstResults }}</td>
                    <td rowspan="2" align="center">{{ 'LFX RESISTANCE' |get_dict_item_by_key:row.dstResults }}</td>
                    <td rowspan="2" align="center">{{ 'MFX RESISTANCE' |get_dict_item_by_key:row.dstResults }}</td>
                    <td rowspan="2" align="center">{{ 'PTO RESISTANCE' |get_dict_item_by_key:row.dstResults }}</td>
                    <td rowspan="2" align="center">{{ 'CS RESISTANCE' |get_dict_item_by_key:row.dstResults }}</td>
                    <td rowspan="2" align="center">{{ 'PAS RESISTANCE' |get_dict_item_by_key:row.dstResults }}</td>
                    <td rowspan="2" align="center">{{ 'LZD RESISTANCE' |get_dict_item_by_key:row.dstResults }}</td>
                    <td rowspan="2" align="center">{{ 'CFZ RESISTANCE' |get_dict_item_by_key:row.dstResults }}</td>
                    <td rowspan="2" align="center">{{ 'BDQ RESISTANCE' |get_dict_item_by_key:row.dstResults }}</td>
                    <td rowspan="2" align="center">{{ 'DLM RESISTANCE' |get_dict_item_by_key:row.dstResults }}</td>

                    <td rowspan="2">{{row.drugResistance }}</td>
                    {% if row.reg1New %}
                    {% if row.month2SmearResult or row.month3SmearResult %}
                    <td colspan="3" align="center">{{ row.month2SmearResult }} / {{ row.month3SmearResult }}</td>
                    {% else %}
                    <td colspan="3">&nbsp;</td>
                    {% endif %}
                    <td colspan="3" align="center">{{ row.month5SmearResult }}</td>
                    <td colspan="3" align="center">{{ row.month6SmearResult }}</td>
                    {% elif row.reg1Rtx %}
                    {% if row.month3SmearResult or row.month4SmearResult %}
                    <td colspan="3" align="center">{{ row.month3SmearResult }} / {{ row.month4SmearResult }}</td>
                    {% else %}
                    <td colspan="3">&nbsp;</td>
                    {% endif %}
                    <td colspan="3" align="center">{{ row.month5SmearResult }}</td>
                    <td colspan="3" align="center">{{ row.month8SmearResult }}</td>
                    {% else %}
                    <td colspan="3">&nbsp;</td>
                    <td colspan="3">&nbsp;</td>
                    <td colspan="3">&nbsp;</td>
                    {% endif %}

                    {% for loop in '9'|get_range %}
                    <td align="center" rowspan="2">
                        {% if row.tb03TreatmentOutcome == loop %}
                        {{ row.tb03TreatmentOutcomeDate }}
                        {% endif %}
                    </td>
                    {% endfor %}
                    <td rowspan="2">{{row.notes }}</td>
                </tr>
                <tr {% if forloop.counter|divisibleby:2 %} bgcolor="#D3D3D3" {% endif %}>
                    <td align="center">{{ row.dateOfBirth }}</td>
                    <td align="center">{{row.continuationPhaseFacility }}</td>
                    <td align="center">{{row.tb03TreatmentStartDate }}</td>
                    <td align="center">{{row.hivTestDate }}</td>
                    <td>{{row.diagnosticSmearDate }}</td>
                    <td>{{row.diagnosticSmearTestNumber }}</td>
                    <td>{{row.diagnosticSmearLab }}</td>
                    <td>{{row.xpertTestDate }}</td>
                    <td>{{row.xpertTestNumber }}</td>
                    <td>{{row.xpertLab }}</td>
                    <td>{{row.hainTestNumber }}</td>
                    <td align="center">{{row.hainINHResult }}</td>
                    <td align="center">{{row.hainRIFResult }}</td>
                    <td>{{row.hainLab }}</td>
                    <td>{{row.hain2TestNumber }}</td>
                    <td align="center">{{row.hain2InjResult }}</td>
                    <td align="center">{{row.hain2FqResult }}</td>
                    <td>{{row.hain2Lab }}</td>
                    <td>{{row.cultureTestDate }}</td>
                    <td>{{row.cultureTestNumber }}</td>
                    <td>{{row.cultureLab }}</td>
                    <td>{{ row.dstResultDate}}</td>
                    {% if row.reg1New %}
                    {% if row.month2SmearDate or row.month3SmearDate %}
                    <td align="center">{{ row.month2SmearDate }} / {{ row.month3SmearDate }}</td>
                    <td align="center">{{ row.month2TestNumber }} / {{ row.month3TestNumber }}</td>
                    <td align="center">{{ row.month2TestLab }} / {{ row.month3TestLab }}</td>
                    {% else %}
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    {% endif %}
                    <td>{{ row.month5SmearDate }}</td>
                    <td>{{ row.month5TestNumber }}</td>
                    <td>{{ row.month5TestLab }}</td>
                    <td>{{ row.month6SmearDate }}</td>
                    <td>{{ row.month6TestNumber }}</td>
                    <td>{{ row.month6TestLab }}</td>
                    {% elif row.reg1Rtx %}
                    {% if row.month3SmearDate or row.month4SmearDate %}
                    <td align="center">{{ row.month3SmearDate }} / {{ row.month4SmearDate }}</td>
                    <td align="center">{{ row.month3TestNumber }} / {{ row.month4TestNumber }}</td>
                    <td align="center">{{ row.month3TestLab }} / {{ row.month4TestLab }}</td>
                    {% else %}
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    {% endif %}
                    <td>{{ row.month5SmearDate }}</td>
                    <td>{{ row.month5TestNumber }}</td>
                    <td>{{ row.month5TestLab }}</td>
                    <td>{{ row.month8SmearDate }}</td>
                    <td>{{ row.month8TestNumber }}</td>
                    <td>{{ row.month8TestLab }}</td>
                    {% else %}
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    {% endif %}


                </tr>
                {% endfor %}

            </table>
        </div>
    </div>
    <input id="exportButton" type="button" onclick="tableToExcel('tb03', 'TB-03')"
       value="{{'mdrtb.exportToExcelBtn'|get_message:request.session.locale}}" />
    <input id="printButton" type="button" onclick="printForm()"
           value="{{'mdrtb.print'|get_message:request.session.locale}}" />
    <button id="saveButton" onclick="saveHtml('tb03', 'TB-03', 'DOTSTB')">{{'mdrtb.save'|get_message:request.session.locale}}</button>
    <a href="/" type="button" id="back" name="back">{{'mdrtb.back'|get_message:request.session.locale}}</a>
    <script>
        if ("{{ reportStatus }}" === "true") {
            document.getElementById("saveButton").disabled = true;
        } else {
            document.getElementById("saveButton").disabled = false;
        }
    </script>

</div>

{% endblock %}